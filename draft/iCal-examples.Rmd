---
title: "iCal examples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{iCal_examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(lubridate, warn.conflicts = F)
library(gs)
library(magrittr)
```

Here are the examples and how they would be run in `gs`.

In most of the example (unless otherwise stated) the start date is 1997-09-02.
At 9am.

```{r}
start_date <- ymd("1997-09-02")
```


> Daily for 10 occurrences:

```{r}
on_every("day", starting = start_date) %>% 
  get_events(n = 10)
```

> Daily until December 24, 1997:

```{r}
on_every("day", starting = start_date) %>% 
  only_occur(before(dmy("24-12-1997"))) %>% 
  get_events() 
```

> Every other day - forever:

```{r}
on_every_second("day", starting = start_date) %>% 
  get_events(10)
```

> Every 10 days, 5 occurrences:

```{r}
on_every_nth(10, "days", starting = start_date) %>% 
  get_events(5)
```

> Every day in January, for 3 years:

```{r}
in_month("Jan") %>% 
  only_occur(in_year(1999:2000)) %>% 
  schedule_days()
```

> Weekly for 10 occurrences:

```{r}
on_every("week", starting = start_date) %>% 
  get_events(10)
```

> Weekly until December 24, 1997:

```{r}
on_every("week", starting = start_date) %>% 
  only_occur(before(ymd("1997-12-24"))) %>% 
  get_events()
```

> Every other week - forever:

```{r}
on_every_second("week", starting = start_date) %>% 
  get_events(50)
```

> Weekly on Tuesday and Thursday for five weeks:

```{r}
on_wday("Tue", "Thu") %>% 
  only_occur(on_or_after(start_date)) %>% 
  schedule_days(to = start_date + weeks(5))
```

There is a difference here. The `gs` result stretches one further than iCal to
include "1997-10-07".

> Every other week on Monday, Wednesday, and Friday until December
 24, 1997, starting on Monday, September 1, 1997:
 
```{r}
in_every_second("week", starting = ymd("1997-09-01")) %>% 
  only_occur(on_or_before(ymd("1997-12-24"))) %>% 
  get_events()
```
 
 
> Every other week on Tuesday and Thursday, for 8 occurrences:

```{r}
on_wday("Tue", "Thu") %>% 
  only_occur(on_every_second("week", starting = start_date)) %>% 
  get_events(8)
```


> Monthly on the first Friday for 10 occurrences:

```{r}
on_first(on_wday("Fri"), within_given = "month") %>% 
  only_occur(on_or_after(start_date)) %>% 
  get_events(10)
```

> Monthly on the first Friday until December 24, 1997:

```{r}
on_first(on_wday("Fri"), within_given = "month") %>% 
  only_occur(on_or_after(start_date)) %>% 
  only_occur(on_or_before(dmy("24/12/1997"))) %>% 
  get_events()
```

> Every other month on the first and last Sunday of the month for 10
 occurrences:
 
```{r}
on_first(on_wday("Sun"), within_given = "month") %>% 
  also_occur(on_last(on_wday("Sun"), within_given = "month")) %>% 
  only_occur(in_every_second("month", starting = start_date)) %>% 
  get_events(10)
```
 
 
> Monthly on the second-to-last Monday of the month for 6 months:

```{r}
on_nth(-2, on_wday("Mon"), within_given = "month") %>% 
  only_occur(on_or_after(start_date)) %>% 
  only_occur(on_or_before(start_date + months(6))) %>% 
  get_events()
```

> Monthly on the third-to-the-last day of the month, forever:

```{r}
### WIP
```

> Monthly on the 2nd and 15th of the month for 10 occurrences:

```{r}
on_mday(2, 15) %>% 
  only_occur(on_or_after(start_date)) %>% 
  get_events(10)
```

> Monthly on the first and last day of the month for 10 occurrences:

> Every 18 months on the 10th thru 15th of the month for 10
 occurrences:
 
```{r}
on_mday(10:15) %>% 
  only_occur(in_every_nth(18, "months", starting = start_date)) %>% 
  get_events(10)
```

> Every Tuesday, every other month:

```{r}
on_wday("Tue") %>% 
  only_occur(in_every_second("month", starting = start_date)) %>% 
  get_events(20)
```

> Yearly in June and July for 10 occurrences:

```{r}
in_month(6:7) %>% 
  get_events(10, since = ymd("19970610"))
```

*There is a difference here, but I think it is because of ambigutity in the
language. The corrected version is below.*

```{r}
on_every("month", starting = ymd("19970610")) %>% 
  only_occur(in_month(6:7)) %>% 
  get_events(10)
```


> Every other year on January, February, and March for 10
 occurrences:
 
```{r}
on_every("month", starting = ymd("19970310")) %>% 
  only_occur(in_month(1:3)) %>% 
  get_events(10)
```
 
 
 > Every third year on the 1st, 100th, and 200th day for 10
 occurrences:
 
```{r}
on_yday(1, 100, 200) %>% 
  only_occur(in_every_nth(3, "year", starting = ymd("19970101"))) %>% 
  get_events(10)
```
 
 > Every 20th Monday of the year, forever:
 
```{r}
on_nth(20, on_wday("Mon"), within_given = "year") %>% 
  get_events(20, since = ymd("19970519"))
```
 
 
 > Monday of week number 20 (where the default start of the week is
 Monday), forever:
 
```{r}
in_isoweek(20) %>% 
  only_occur(on_wday("Mon")) %>% 
  get_events(20, ymd("19970512"))
```
 
> Every Thursday in March, forever:

```{r}
on_wday("Thu") %>% 
  only_occur(in_month("Mar")) %>% 
  get_events(20, since = ymd("1997-03-13"))
```

> Every Thursday, but only during June, July, and August, forever:

```{r}
in_month("Jun", "Jul", "Aug") %>% 
  only_occur(on_wday("Thu")) %>% 
  get_events(20, since = ymd("1997-06-05"))
```

> Every Friday the 13th, forever:

```{r}
on_wday("Fri") %>% 
  only_occur(on_mday(13)) %>% 
  get_events(20, since = ymd("1997-09-02"))
```

> The first Saturday that follows the first Sunday of the month,
 forever:
 
```{r}
on_first(on_wday("Sun"), within_given = "month") %>% 
  roll_forward(to_schedule = on_wday("Sat")) %>% 
  get_events(20, since = ymd("1997-09-13"))
```
 
> Every 4 years, the first Tuesday after a Monday in November,
 forever (U.S. Presidential Election day):
 
```{r}
# in_every_nth(4, "years", starting = ymd("19961105")) %>% 
#   only_occur(on_wday("Mon")) %>% 
#   roll_forward(to_schedule = on_wday("Tue")) %>% 
#   get_events(20)
```
 
> The third instance into the month of one of Tuesday, Wednesday, or
 Thursday, for the next 3 months:
 
```{r}
my_start_date <- ymd("19970904")

on_nth(3, on_wday("Tue", "Wed", "Thu"),within_given = "month") %>% 
  get_events(since = my_start_date, until = my_start_date + months(3))
```

> The second-to-last weekday of the month:

```{r}
on_nth(-2, on_weekday(), within_given = "month") %>% 
  get_events(20, since = ymd("19970929"))
```


> Every 3 hours from 9:00 AM to 5:00 PM on a specific day:

```{r}
# on_every_nth(3, "hours", starting = "19970902") %>% 
#   only_occur(on_or_after(hms("09:00:00"))) %>% 
#   only_occur(on_or_before(hms("17:00:00"))) %>% 
#   get_events()
```

> Every 15 minutes for 6 occurrences:

> Every hour and a half for 4 occurrences:

> Every 20 minutes from 9:00 AM to 4:40 PM every day:

There are a few examples I need to express in words.
 
