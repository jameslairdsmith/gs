---
title: "Understanding schedule limits"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{understanding-schedule-limits}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Once you have created a schedule object with your desired specifications, 
`scheduler` allows you to retrieve the dates which fall on that schedule. This
is done using the `schedule_*()` family of functions. 

Under normal circumstances this process should be seamless and intuitive when
following the documentation. But for those looking for a deeper understanding 
of how these dates are generated, this vigette will provide an explanation and
walkthrough.

To perform the operations yourself, you first need to load these packages:

```{r setup}
library(scheduler)
library(magrittr)
```

## Infinite events

Some recurring calendar events are a theoretically infinite in number. For 
example how many Christmases will there be in the future?

```{r}
on_christmas <- on_mday(25) %>% only_occuring(in_month("Dec"))
```

If you ask `scheduler` to retrieve for you all the occurrences of Christmas, 
you will find that it refuses to do so:

```{r eval=FALSE}
schedule(on_christmas)
#> Error in seq.Date(from = from, to = to, by = "1 day"): 'from' must be a "Date" object
```

This is possible because `scheduler` knows the number of possible Christmases
is infinite and that it cannot produce for you the complete set. To make your
request possible, you must place some limits on which Christmases you wish to
schedule.

## Explicit limits

The `schedule()` funcion provides you a way to do that. It has arguments `from`
and `to`, which allow you to specify the start and end dates of the schedule.
So if you wanted to retrieve the dates for Christmases between 2000 and 2004 
you could do so as follows:

```{r}
schedule(on_christmas, from = as.Date("2000-01-01"), to = as.Date("2004-12-31"))
```

To be more succinct, the `schedule()` function will also accept numeric years
for these arguments. This is a convenient way of specifying from the start of
the first year to the end of the last year (equivalent to the code directly
above):

```{r}
schedule(on_christmas, from = 2000, to = 2004)
```

If you only interested in events occuring during a single calendar year, you
can also use the `during =` argument, which creates date limits from the start 
to the end of the year specified:

```{r}
schedule(on_christmas, during = 2000)
```

## Implicit limits

Specifying limits in the `schedule()` function isn't always necessary however.
Where possible `scheduler` will detect there to be a finite set of possible
events in your schedule and compute them for you. This happens variously when
using the functions `in_year()`, `before()`, `after()` and `in_between()`.
All these functions can place implicit limits on a schedule and thus save you
having to place explicit limits on it.

### `in_year()` limits

If you specify the years of a schedule using the `in_year()` function, 
`scheduler` will infer the start and end dates from that.

```{r}
on_christmas %>% 
  only_occuring(in_year(2000)) %>% 
  schedule()
```

Notice I did not have to specify `to =` and `from =` limits in the 
`schedule()` function for this to work. The `schedule()` function automatically 
detected the limits of the schedule and used them appropriately.

I could do the same thing if looking at the occurance of Chrismas in 
more than one year:

```{r}
on_christmas %>% 
  only_occuring(in_year(2000, 2004)) %>% 
  schedule()
```

Finally you could do the same thing when looking at a range of years:

```{r}
on_christmas %>% 
  only_occuring(in_year(2000:2004)) %>% 
  schedule()
```

### `before()`, `after()` and `in_between()` limits.

### `on_date()` limits

For completeness it is worth noting that the `on_date()` function also encodes
limits on a schedule. In practice, this is less useful than the other 
functions for this purpose as `on_date()` is typically only used for 
supplementing or reducing a schedule to include or abandon certain defined 
dates. Users should be able to ignore this feature without it being 
intrusive.

## Inheriting limits
