---
title: "R Notebook"
output: NA
---

 

```{r setup}
library(lubridate)
library(magrittr)
```

```{r}
my_dates <- 
  seq.Date(from = as.Date("2000-01-01"),
           to = as.Date("2000-12-31"),
           by = "1 day")

on_sun <- on_wday("Sun")

last_sun_month <- on_last(on_sun, within_given = "month")

on_mon <- on_wday("Mon")

my_result <- 
  roll_forward(last_sun_month, to_following = on_mon) %>% 
  schedule_days(during = 2000)

#my_result

schedule_days(last_sun_month, during = 2000)
```

```{r}
my_dates <- 
  seq.Date(from = as.Date("2000-01-01"),
           to = as.Date("2000-12-31"),
           by = "1 day")

last_sun_month <- on_last(on_wday("Sun"), within_given = "month")
on_mon <- on_wday("Mon")

candidate_dates <- my_dates

is_applicable_date <- happen(on_mon, candidate_dates)

candidate_dates[!is_applicable_date] <- NA

candidate_dates[is_applicable_date] <- candidate_dates[is_applicable_date] - days(1)

happen(on_mon, candidate_dates)

#happen(last_sun_month, candidate_dates)

#<- happen(last_sun_month, my_dates)
```

```{r}
candidate_dates <- seq.Date(from = as.Date("2000-01-01"),
                            to = as.Date("2000-12-31"),
                            by = "1 day")

last_sun_month <- on_last(on_wday("Sun"), within_given = "month")
on_target_schedule <- on_wday("Friday")

rolled_dates <- candidate_dates
is_initial_date <- happen(last_sun_month, rolled_dates)

while(any(!happen(on_target_schedule, rolled_dates[is_initial_date]))){
  
  rolled_dates[is_initial_date] <- rolled_dates[is_initial_date] + days(1)
  
}

candidate_dates[is_initial_date]
rolled_dates[is_initial_date]


# while(any(!happen(on_mon, rolled_dates))){
#   
#   rolled_dates[is_possible_final_date] <- 
#     rolled_dates[is_possible_final_date] + days(1)
# }

#happen(on_mon, rolled_dates) & is_possible_final_date
#is_possible_final_date & is_initial_date

```

```{r}
on_payday <- on_mday(25)

unchanged_result <- schedule_days(on_payday, during = 2000)

result <- 
  on_payday %>% 
  roll_by(-1, "day", .p = on_wday("Sat")) %>% 
  roll_by(+1, "day", .p = on_wday("Sun")) %>% 
  schedule_days(during = 2000) 

tibble::tibble(unchanged_result, 
               wday(unchanged_result, label = T, abbr = T),
               result, 
               wday(result, label = T, abbr = T))

#result[happen(only_occur(on_payday,on_wday("Sat")) , result)]
#wday(result, label = T, abbr = T)

# result
```

```{r}
on_payday <- on_mday(25)

on_payday %>% 
  roll_by(-1, "day", .p = on_wday("Sat")) %>% 
  roll_by(+1, "day", .p = on_wday("Sun")) %>% 
  schedule_days(during = 2000) 
```

